debugging&&console.log("Hello! ZT in Debugging. (deactivate in zeichentool.html script tag id: debugging state)");var basicToolStrokeWidth=2,strokeWidth=10,scrollbarWidth=20,width=window.innerWidth-scrollbarWidth,height=window.innerHeight-50,scalex=1,scaley=1,osziFlash=new Array,csvGroupCache=new Array,ursprungXoffset=.14*width,ursprungYoffset=.12*height,xDiffPerCent=.0614,yDiffPerCent=.0776,yDiffWeiteCH1=20,yDiffWeiteCH2=20,xDiffWeite=1,lineStepOnLogLine=[0,.301,.176,.125,.097,.079,.067,.058,.051,.046],firstDekadeEndeLOG=1,ursprungXoffsetLOG=.04*width,xDiffDekPerCentLOG=.3409,ursprungYoffsetLOG=.9238*height,yDiffPerCentLOG=.0859,yDiffWeiteLOG=5,platzHalterKali=[ursprungXoffset,ursprungYoffset,xDiffPerCent,yDiffPerCent,xDiffWeite,yDiffWeiteCH1,yDiffWeiteCH2],backroundKalibrierungTab=[[.1373*width,.1432*height,.0577,.1019,5,1],[.1235*width,.0917*height,.0642,.0833,20,1,1],[.1223*width,.0684*height,.0651,.0531,.1,.1,.1],[.1073*width,.1836*height,.1014,.1018,1,.1,.1],[.1351*width,.1816*height,.0657,.1021,1,.1,.1],[.3273*width,.5019*height,.0635,.1192,1,1,1],platzHalterKali,platzHalterKali,platzHalterKali,[.3262*width,.5019*height,.3156,.1192,.24,111.6,111.6],[.0714*width,.0684*height,.0361,.0532,5,1,1],[.0601*width,.0645*height,.0295,.0477,100,20,20],[ursprungXoffsetLOG,ursprungYoffsetLOG,xDiffDekPerCentLOG,yDiffPerCentLOG,xDiffWeite,5,firstDekadeEndeLOG],[ursprungXoffsetLOG,ursprungYoffsetLOG,xDiffDekPerCentLOG,yDiffPerCentLOG,xDiffWeite,10,firstDekadeEndeLOG],[ursprungXoffset,ursprungYoffset,xDiffPerCent,yDiffPerCent,xDiffWeite,yDiffWeiteCH1,yDiffWeiteCH2]],backroundKalibrierung=backroundKalibrierungTab[1];let container=document.getElementById("container");var canvas=document.createElement("canvas");canvas.width=width,canvas.height=height;var stage=new Konva.Stage({container:"container",width:width,height:height}),image=new Konva.Image({id:"handwritten",image:canvas,x:0,y:0,stroke:"red",strokeWidth:strokeWidth}),text=new Konva.Text({x:10,y:10,fontFamily:"Calibri",fontSize:24,text:"",fill:"black"}),circle=new Konva.Circle({x:stage.width()/2,y:stage.height()/2,radius:1,fill:"transparent",stroke:"red",strokeWidth:2}),context=canvas.getContext("2d");context.strokeStyle="#000000",context.lineJoin="round",context.lineWidth=1;var isPaint=!1,lastPointerPosition={x:0,y:0},mode="brush",countGerade=0,countText=0,countImage=0,shadowOffset=20,tween=null,blockSnapSize=20,layer=new Konva.Layer,backlayer=new Konva.Layer,circlelayer=new Konva.Layer,textlayer=new Konva.Layer,gridGroup=new Konva.Group;circlelayer.add(circle),layer.add(image),circlelayer.add(text),backlayer.add(gridGroup),stage.add(backlayer),stage.add(circlelayer),stage.add(layer),stage.add(textlayer);var padding=blockSnapSize;debugging&&(console.log("_______________Info Gridding_______________"),console.log("Breite: "+width),console.log("Kästchen: "+padding),console.log("Anzahl Kästchen: "+width/padding),console.log("_______________Info Kalibrierung_______________"),console.log("** Klichen Sie den Ursprung und das Offset wird Ihnen Angezeigt **"),console.log("Breite = "+width),console.log("Höhe = "+height),stage.on("click",(e=>{let t=stage.getPointerPosition(),o=t.x,n=t.y;console.log("New Click New Offset"),console.log("x-Offset = "+o/width),console.log("y-Offset = "+(height-n)/height)})));for(var i=0;i<width/padding;i++){let e=new Konva.Line({points:[Math.round(i*padding)+.5,0,Math.round(i*padding)+.5,height],stroke:"#ddd",strokeWidth:1});gridGroup.add(e)}for(var j=0;j<height/padding;j++){let e=new Konva.Line({points:[0,Math.round(j*padding),width,Math.round(j*padding)],stroke:"#ddd",strokeWidth:.5});gridGroup.add(e)}var arrowCount=0;function newArrow(e,t={x:0,y:0},o=[blockSnapSize,blockSnapSize,5*blockSnapSize,blockSnapSize],n={x:5*blockSnapSize,y:blockSnapSize},a={x:170,y:75},i=`Vektor ${arrowCount}`){arrowCount++;let r=i,s=new Konva.Group({id:r,name:"arrow-save"});var l=new Konva.Arrow({id:r,...t,points:o,draggable:!0,fill:"black",stroke:"black",strokeWidth:4,shadowOffset:{x:1,y:1},hitStrokeWidth:20,shadowOpacity:.4,pointerLength:blockSnapSize,pointerWidth:.5*blockSnapSize});let d=new Konva.Circle({...n,radius:13,fill:"grey",stroke:"black",draggable:!0,opacity:.25});var c=new Konva.Label({...a,opacity:.75,draggable:!0});c.add(new Konva.Tag({fill:"black",pointerDirection:"down",pointerWidth:10,pointerHeight:10,lineJoin:"round",shadowColor:"black",shadowBlur:10,shadowOffsetX:10,shadowOffsetY:10,shadowOpacity:.5}));let u=new Konva.Text({text:" ",fontFamily:"Calibri",fontSize:18,padding:5,fill:"white"});function g(e){let t=l.getPoints(),o=l.getPosition(),n=d.getPosition();t[2]=n.x-o.x,t[3]=n.y-o.y,l.setPoints(t)}setVektorName(u,l,blockSnapSize),c.add(u),s.add(l),s.add(c),s.add(d),g(),d.on("dragmove",(e=>{g(),setVektorName(u,l,blockSnapSize),stage.batchDraw()})),l.on("dragmove",(e=>{let t=l.getPoints(),o=l.getPosition();d.position({x:t[2]+o.x,y:t[3]+o.y}),stage.batchDraw()})),l.on("dblclick dbltap",(function(){this.getParent().destroy(),stage.draw()})),c.on("dblclick dbltap",(()=>{var e=u.getAbsolutePosition(),t=stage.container().getBoundingClientRect(),o=t.left+e.x,n=t.top+e.y,a=document.createElement("textarea");document.body.appendChild(a),a.value=l.id(),a.style.position="absolute",a.style.top=n+"px",a.style.left=o+"px",a.style.width=u.width()+"px",a.focus(),a.addEventListener("keydown",(function(e){13===e.keyCode&&(l.id(a.value),setVektorName(u,l,blockSnapSize),stage.draw(),document.body.removeChild(a))}))})),textlayer.add(s),stage.draw(),showAsGrabbable(l),showAsGrabbable(u),showAsGrabbable(d),makeItHover(d,stage),makeItHover(l,stage)}let osziControls=new Array;function newPanel(e,t,o,n,a,i,r){let s=new Array,l=[["0.01ms",1e-5],["0.02ms",2e-5],["0.05ms",5e-5],["0.1ms",1e-4],["0.2ms",2e-4],["0.5ms",5e-4],["1ms",.001]];s=n?l:[["0.01V",.01],["0.02V",.02],["0.05V",.05],["0.1V",.1],["0.2V",.2],["0.5V",.5],["1V",1],["2V",2],["5V",5]];let d=roundDown(s.length/2);function c(e,t){let o="lightgray",n="gray",a="gray",i="white";e.on("mouseover touchstart",(function(){e.setAttrs({fill:o}),t.setAttrs({fill:n})})),e.on("mouseout touchend",(function(){e.setAttrs({fill:a}),t.setAttrs({fill:i})})),e.on("mousedown",(function(){t.setAttrs({fill:"red"})})),e.on("mouseup",(function(){t.setAttrs({fill:i})})),t.on("mouseover touchstart",(function(){t.setAttrs({fill:n}),e.setAttrs({fill:o})})),t.on("mouseout touchend",(function(){t.setAttrs({fill:i}),e.setAttrs({fill:a})})),t.on("mousedown",(function(){t.setAttrs({fill:"red"})})),t.on("mouseup",(function(){t.setAttrs({fill:i})}))}n?backroundKalibrierungTab[5][4]=s[d][1]:backroundKalibrierungTab[5][5]=s[d][1];var u=new Konva.Label({id:e+d,x:i,y:r,opacity:.75,draggable:!0});u.add(new Konva.Rect({fill:"lightgray",width:120,height:80,stroke:"red",strokeWidth:1})),u.add(new Konva.Text({width:120,height:80,text:t,fontFamily:"Calibri",fontSize:22,align:"center",fontStyle:"bold",padding:5,fill:"black"}));var g=new Konva.Rect({id:"up"+e,x:5,y:28,width:20,height:20,fill:"gray",shadowBlur:3,cornerRadius:2}),h=new Konva.Rect({id:"down"+e,x:5,y:53,width:20,height:20,fill:"gray",shadowBlur:3,cornerRadius:2}),f=new Konva.Text({id:"upArrow"+e,x:28,y:28,text:"<",fontFamily:"Calibri",fontSize:25,padding:2,rotation:90,fontStyle:"bold",fill:"white"}),m=new Konva.Text({id:"downArrow"+e,x:2,y:73,text:"<",fontFamily:"Calibri",fontSize:25,padding:2,rotation:270,fontStyle:"bold",fill:"white"}),w=new Konva.Text({y:9,width:120,height:80,text:s[d][0],fontFamily:"Calibri",fontSize:20,align:"right",verticalAlign:"middle",fontStyle:"bold",padding:10,fill:"black"});return u.add(w),u.add(g),u.add(f),u.add(h),u.add(m),c(g,f),c(h,m),g.on("click touchstart",(function(){d<l.length-1&&d++,w.text(s[d][0]),n?backroundKalibrierungTab[5][4]=s[d][1]:backroundKalibrierungTab[5][4+a]=s[d][1],stage.batchDraw()})),f.on("click touchstart",(function(){d<s.length-1&&d++,w.text(s[d][0]),n?backroundKalibrierungTab[5][4]=s[d][1]:backroundKalibrierungTab[5][4+a]=s[d][1],stage.batchDraw()})),h.on("click touchstart",(function(){d>0&&d--,w.text(s[d][0]),n?backroundKalibrierungTab[5][4]=s[d][1]:backroundKalibrierungTab[5][4+a]=s[d][1],stage.batchDraw()})),m.on("click touchstart",(function(){d>0&&d--,w.text(s[d][0]),n?backroundKalibrierungTab[5][4]=s[d][1]:backroundKalibrierungTab[5][4+a]=s[d][1],stage.batchDraw()})),showAsClickable(g),showAsClickable(f),showAsClickable(h),showAsClickable(m),textlayer.add(u),u}osziControls.push(newPanel("Zeit","CH1/CH2",textlayer,!0,0,.7822*width,.27*height)),osziControls.push(newPanel("VoltCH1","CH1",textlayer,!1,1,.7282*width,.704*height)),osziControls.push(newPanel("VoltCH2","CH2",textlayer,!1,2,.7282*width+130,.704*height)),osziControls.forEach((e=>{e.hide(),textlayer.draw()}));var imageObj=new Image;function setBackground(e){document.getElementById("hintergrund").selectedIndex=e,changeToolBackground()}function changeToolBackground(){let e=document.getElementById("hintergrund").value;imageObj.src=sources[e],backroundKalibrierung=backroundKalibrierungTab[e],document.getElementById("wertetabellenInfo").innerHTML=einheitenInfo[e],debugging&&console.log("Background: "+e),5==e?osziControls.forEach((e=>{e.show(),textlayer.draw()})):osziControls.forEach((e=>{e.hide(),textlayer.draw()}))}let timeoutRef,currentShape;function handleLongPress(e){console.log("long press"),console.log(e.target),openContextMenue(e)}function handleTouchStart(e){e.target.parentElement!=menuNode&&(menuNode.style.display="none"),timeoutRef=setTimeout((()=>{handleLongPress(e)}),600)}function handleTouchEnd(){clearTimeout(timeoutRef)}imageObj.onload=function(){let e=document.getElementById("hintergrund").value;var t=new Konva.Image({draggable:!1,x:.8*strokeWidth,y:.8*strokeWidth,image:imageObj,width:width-2*strokeWidth*.8,height:height-2*strokeWidth*.8});backlayer.add(t),7==e?gridGroup.show():gridGroup.hide(),stage.draw()},imageObj.src="Data/invisible.svg",stage.draw(),stage.on("touchstart mousedown",handleTouchStart),stage.on("touchend mouseup",handleTouchEnd),stage.on("touchmove mousemove",handleTouchEnd);var menuNode=document.getElementById("menu");function openContextMenue(e){if(isPaint=!1,e.evt.preventDefault(),e.target===textlayer||e.target===layer||e.target===image||e.target===container)return void clearTimeout(timeoutRef);currentShape=e.target,menuNode.style.display="initial";const t=stage.container().getBoundingClientRect();menuNode.style.top=`${t.top+stage.getPointerPosition().y+4}px`,menuNode.style.left=`${t.left+stage.getPointerPosition().x+4}px`}function writeMessage(e){text.text(e)}function updateColor(){let e=document.getElementById("BasicToolColorInput");context.strokeStyle=e.value}function preview_image(e){countImage+=1;var t=new Image(width-2*strokeWidth*.8,height-2*strokeWidth*.8),o=new FileReader;o.onload=function(){t.src=o.result};var n=document.getElementById("file-input-pic").files[0];console.log(n),o.readAsDataURL(e.target.files[0]);var a=new Konva.Image({image:t,draggable:!1,x:.8*strokeWidth,y:.8*strokeWidth});const i=new Konva.Circle({x:7+20*countImage,y:20,radius:10,fill:"red"});textlayer.add(i);const r=new Konva.Text({text:"x",x:2+20*countImage,y:10,fontSize:charpix});textlayer.add(r),i.on("touchstart click",(()=>{i.destroy(),r.destroy(),a.destroy(),stage.draw()})),r.on("touchstart click",(()=>{i.destroy(),r.destroy(),a.destroy(),stage.draw()})),i.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),this.setAttrs({fill:"#AA0000"}),textlayer.draw(),is_touch_device()&&this.setAttrs({fill:"red"})})),i.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),this.setAttrs({fill:"red"}),textlayer.draw()})),r.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),i.setAttrs({fill:"#AA0000"}),textlayer.draw(),is_touch_device()&&i.setAttrs({fill:"red"})})),r.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),i.setAttrs({fill:"red"}),textlayer.draw()})),setTimeout((function(){backlayer.add(a),backlayer.batchDraw(),stage.draw()}),100)}document.getElementById("pulse-button").addEventListener("click",(()=>{console.log(currentShape),currentShape.to({scaleX:2,scaleY:2,onFinish:()=>{currentShape.to({scaleX:1,scaleY:1})}})})),document.getElementById("delete-button").addEventListener("click",(()=>{"line-save"!==currentShape.getParent().getAttr("name")&&"text-save"!==currentShape.getParent().getAttr("name")&&"arrow-save"!==currentShape.getParent().getAttr("name")||(currentShape.getParent().destroy(),stage.batchDraw(),menuNode.style.display="none"),"arrow-save"===currentShape.getParent().getParent().getAttr("name")&&(currentShape.getParent().getParent().destroy(),stage.batchDraw(),menuNode.style.display="none")})),menuNode.addEventListener("focusout",(()=>{menuNode.style.display="none"})),stage.on("contextmenu",(function(e){openContextMenue(e)})),stage.on("mousedown touchstart",(function(e){layer.setZIndex(2),circlelayer.setZIndex(1),stage.draw(),isPaint=!0,lastPointerPosition=stage.getPointerPosition()})),stage.on("mouseup touchend",(function(e){layer.setZIndex(1),circlelayer.setZIndex(2),stage.draw(),isPaint=!1})),stage.on("mousemove touchmove",(function(e){var t=stage.getPointerPosition(),o=t.x*(1/scalex),n=t.y*(1/scaley);if(circle.x(o),circle.y(n),isPaint&&"handwritten"===e.target.getAttr("id")){var a=stage.getPointerPosition(),i=a.x,r=a.y;debugging&&writeMessage("x: "+i+", y: "+r),"brush"===mode&&(context.globalCompositeOperation="source-over"),"eraser"===mode&&(context.globalCompositeOperation="destination-out"),context.beginPath(),context.moveTo(lastPointerPosition.x*(1/scalex),lastPointerPosition.y*(1/scaley));var s=stage.getPointerPosition();context.lineTo(s.x*(1/scalex),s.y*(1/scaley)),context.closePath(),context.stroke(),lastPointerPosition=s,layer.batchDraw()}})),stage.on("mouseleave touchend",(function(e){isPaint=!1}));var charpix=20;function createTextfeld(e,t,o=0,n=1,a=200,i="Doppelclick zum Editieren."){t=void 0!==t?t:{x:50+10*countText,y:80+10*countText},countText+=1;var r=new Konva.Group({name:"text-save"}),s=new Konva.Text({text:i,x:t.x,y:t.y,fontSize:charpix,draggable:!0,rotation:o,width:a*n}),l=new Konva.Transformer({node:s,enabledAnchors:["middle-right"],anchorSize:15});l.on("mousemove touchmove dragmove transformstart",(e=>{clearTimeout(d)})),l.on("transformend dragend mouseup touchend",(()=>{clearTimeout(d),d=setTimeout((()=>{l.hide(),textlayer.draw()}),3e3)}));let d,c=0;s.on("transform",(function(e){if(clearTimeout(d),s.rotation()===c){if(s.scaleX()<1&&s.width()<70)return;s.setAttrs({width:s.width()*s.scaleX()})}c=s.rotation()})),r.add(s),r.add(l),textlayer.add(r),textlayer.draw(),l.hide(),r.on("touchstart mousedown",(e=>{l.show(),clearTimeout(d),d=setTimeout((()=>{l.hide(),textlayer.draw()}),3e3),textlayer.draw()})),l.on("touchstart mousedown",(e=>{e.cancelBubble=!0})),s.on("dbltap dblclick",(e=>{textlayer.draw(),l.hide(),s.hide(),textlayer.draw();var t=s.absolutePosition(),o=stage.container().getBoundingClientRect(),n=o.left+t.x,a=o.top+t.y,i=document.createElement("textarea");document.body.appendChild(i),i.value=s.text(),i.style.position="absolute",i.style.top=a+"px",i.style.left=n+"px",i.style.width=s.width()-2*s.padding()+"px",i.style.height=s.height()-2*s.padding()+5+"px",i.style.fontSize=s.fontSize()+"px",i.style.border="none",i.style.padding="0px",i.style.margin="0px",i.style.overflow="hidden",i.style.background="none",i.style.outline="none",i.style.resize="none",i.style.lineHeight=s.lineHeight(),i.style.fontFamily=s.fontFamily(),i.style.transformOrigin="left top",i.style.textAlign=s.align(),i.style.color=s.fill(),rotation=s.rotation();var r="";rotation&&(r+="rotateZ("+rotation+"deg)");var d=0;function c(){i.parentNode.removeChild(i),window.removeEventListener("click",u),s.show(),l.show(),l.forceUpdate(),textlayer.draw()}function u(e){e.target!==i&&(s.text(i.value),c(),l.hide(),textlayer.draw())}navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(d+=2+Math.round(s.fontSize()/20)),r+="translateY(-"+d+"px)",i.style.transform=r,i.style.height="auto",i.style.height=i.scrollHeight+3+"px",i.focus(),i.addEventListener("keydown",(function(e){13!==e.keyCode||e.shiftKey||(s.text(i.value),c(),l.hide(),textlayer.draw()),27===e.keyCode&&c()})),i.addEventListener("keydown",(function(e){scale=s.getAbsoluteScale().x,function(e){e||(e=s.placeholder.length*s.fontSize());var t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;(t||o)&&(e=Math.ceil(e)),(document.documentMode||/Edge/.test(navigator.userAgent))&&(e+=1),i.style.width=e+"px"}(s.width()*scale),i.style.height="auto",i.style.height=i.scrollHeight+s.fontSize()+"px"}))})),s.on("mouseover",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.add("grabbable")})),s.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser"))}))}function downloadURI(e,t){var o=document.createElement("a");o.download=t,o.href=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),delete o}function handleInputKeydown(e){13===e.which&&downloadPic()}function downloadPic(){let e=stage.toDataURL().replace("image/png","image/octet-stream"),t=document.getElementById("exportInput");""==t.value?downloadURI(e,"ZT.png"):t.value.search(".png")>-1?downloadURI(e,t.value):downloadURI(e,t.value+".png")}function readpoints(e,t){let o,n,a,i;void 0!==t?(o="dataTable"+t,n="dGraph"+t,a="showGraph"+t,i="graph-name"+t):(o="dataTable0",n="dGraph0",a="showGraph0",i="graph-name0");let r=document.getElementById("hintergrund").value,s=!1;12!=r&&13!=r||(s=!0);let l=document.getElementById(i),d=getRandomColor();var c=new Konva.Label({x:75,y:75,draggable:!0});c.add(new Konva.Tag({fill:"#bbb",stroke:d,shadowColor:"black",shadowBlur:3,shadowOffset:[10,10],shadowOpacity:.7,lineJoin:"round",pointerDirection:"right",pointerWidth:10,pointerHeight:10,cornerRadius:5})),c.add(new Konva.Text({text:l.value,fontSize:12,lineHeight:1.2,padding:2,fill:d})),showAsGrabbable(c);var u=new Konva.Group({});textlayer.add(u),u.add(c);for(var g=get(o),h=0;h<g.length;h++)if(h%2==1)g[h]=-1*(g[h]/backroundKalibrierung[5]*(backroundKalibrierung[3]*height)-height+backroundKalibrierung[1]);else if(s){let e=g[h];e*=1.001;let t=0,o=0;for(;e>1;)e/=10,t++;let n=0,a=10*e-roundDown(10*e);for(n=1;n<=10*e;n++)o+=lineStepOnLogLine[n-1];lineStepOnLogLine[0|e];g[h]=t*backroundKalibrierung[2]*width+o*backroundKalibrierung[2]*width+backroundKalibrierung[0]+a*lineStepOnLogLine[n-1]*backroundKalibrierung[2]*width,debugging&&(console.log("Rest: "+a),console.log("K: "+n),console.log("lineStepOnLogLine[k-1]: "+lineStepOnLogLine[n-1]),console.log("xxOff: "+10*-(0|e)+10*e),console.log("extraOff: "+o),console.log("Ausgabe: "+g[h]))}else g[h]=g[h]/backroundKalibrierung[4]*(backroundKalibrierung[2]*width)+backroundKalibrierung[0];for(var f=0;f<g.length;f+=2){var m=new Konva.Circle({x:g[f],y:g[f+1],radius:5,fill:d,stroke:"black",strokeWidth:4}),w=new Konva.Text({x:g[f]+5,y:g[f+1]+5,text:"P"+f/2,fontSize:20,fontFamily:"Calibri",fill:d});u.add(m),u.add(w)}debugging&&(console.log("_______________Info Gelesene Punkte_______________"),console.log(g));var b=new Konva.Line({points:g,tension:.5,strokeWidth:3,hitStrokeWidth:20,stroke:d});u.add(b),document.getElementById(n).addEventListener("click",(function(){u.destroy(),stage.draw()}),!1),document.getElementById(a).addEventListener("click",(function(){u.destroy(),stage.draw()}),!1),stage.draw()}function showcsv(e,t){let o=drawGraph(e,t);console.log("group",o),csvGroupCache[t]=o;let n=new Array,a=stage.findOne("#upZeit"),i=stage.findOne("#downZeit"),r=stage.findOne("#upArrowZeit"),s=stage.findOne("#downArrowZeit");if(1==t){let e=stage.findOne("#upVoltCH1"),t=stage.findOne("#downVoltCH1"),o=stage.findOne("#upArrowVoltCH1"),l=stage.findOne("#downArrowVoltCH1");n=[a,i,r,s,e,t,o,l]}else{let e=stage.findOne("#upVoltCH2"),t=stage.findOne("#downVoltCH2"),o=stage.findOne("#upArrowVoltCH2"),l=stage.findOne("#downArrowVoltCH2");n=[a,i,r,s,e,t,o,l]}n.forEach(((e,t)=>{e.addEventListener("click.event1",(function(){n.forEach((e=>{e.off("click.event1")})),void 0!==csvGroupCache[1]&&(csvGroupCache[1].destroy(),showcsv(osziFlash[1],1)),void 0!==csvGroupCache[2]&&(csvGroupCache[2].destroy(),showcsv(osziFlash[2],2)),stage.draw()}),!1)})),stage.draw()}function drawGraph(e,t){t=void 0!==t?t:1;document.getElementById("hintergrund").value;let o=document.getElementById("quali-"+t),n=(document.getElementById("f"),parseFloat(o.value)),a="CSVData "+t;e.shift();let i="#000000";void 0!==csvGroupCache[t]&&csvGroupCache[t].destroy(),i=1==t?"#0000FF":"#00FF00";var r=new Konva.Label({x:75,y:200,draggable:!0});r.add(new Konva.Tag({fill:"#bbb",stroke:i,shadowColor:"black",shadowBlur:3,shadowOffset:[10,10],shadowOpacity:.7,lineJoin:"round",pointerDirection:"right",pointerWidth:10,pointerHeight:10,cornerRadius:5})),r.add(new Konva.Text({text:a,fontSize:12,lineHeight:1.2,padding:2,fill:i})),r.on("dblclick",(function(){csvGroupCache[t].destroy()})),showAsGrabbable(r);var s=new Konva.Group({});textlayer.add(s),s.add(r);let l=new Array;for(var d=0;d<e.length;d+=n)l.push(parseFloat(e[d][0])),l.push(parseFloat(e[d][1]));for(d=0;d<l.length;d++)l[d]=d%2==1?-1*(l[d]/backroundKalibrierung[4+t]*(backroundKalibrierung[3]*height)-height+backroundKalibrierung[1]):l[d]/backroundKalibrierung[4]*(backroundKalibrierung[2]*width)+backroundKalibrierung[0];for(var c=0;c<l.length;c+=2){var u=new Konva.Circle({x:l[c],y:l[c+1],radius:5,fill:i,stroke:"black",strokeWidth:4});s.add(u)}var g=new Konva.Line({points:l,tension:.5,strokeWidth:3,hitStrokeWidth:20,stroke:i});return s.add(g),s}function createLine(e,t,o){t=void 0!==t?t:{x:stage.width()/2+10*countGerade,y:stage.height()/2+10*countGerade},o=void 0!==o?o:{x:stage.width()/2+100+10*countGerade,y:stage.height()/2+10*countGerade};var n=new Konva.Group({name:"line-save"});countGerade+=1;var a=new Konva.Circle({x:t.x,y:t.y,radius:10,fill:"grey",stroke:"black",strokeWidth:1,draggable:!0}),i=a.absolutePosition(),r=new Konva.Circle({x:o.x,y:o.y,radius:10,fill:"grey",stroke:"black",strokeWidth:1,draggable:!0}),s=r.absolutePosition(),l=new Konva.Line({points:[i.x,i.y,s.x,s.y],stroke:getRandomColor(),strokeWidth:3,lineCap:"round",lineJoin:"round",tension:1,draggable:!1});n.add(a,r,l),textlayer.add(n),l.moveToBottom(),textlayer.draw(),a.on("dragmove",(function(){i=a.getPosition(),l.setAttrs({points:[i.x,i.y,s.x,s.y]}),textlayer.batchDraw()})),r.on("dragmove",(function(){s=r.getPosition(),l.setAttrs({points:[i.x,i.y,s.x,s.y]}),textlayer.batchDraw()})),showAsGrabbable(a),showAsGrabbable(r)}function fitStageIntoParentContainer(){isPaint=!1;var e=document.querySelector("#stage-parent"),t=e.offsetWidth,o=e.offsetHeight;scalex=t/width,scaley=o/height,stage.width(width*scalex),stage.height(height*scaley),stage.scale({x:scalex,y:scaley}),stage.batchDraw()}function clearContext(){context.clearRect(0,0,canvas.width,canvas.height),stage.draw()}window.addEventListener("resize",fitStageIntoParentContainer);