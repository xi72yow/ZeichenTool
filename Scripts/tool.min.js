debugging&&console.log("Hello! ZT in Debugging. (deactivate in zeichentool.html script tag id: debugging state)");var basicToolStrokeWidth=2,strokeWidth=10,scrollbarWidth=20,width=window.innerWidth-scrollbarWidth,height=window.innerHeight-50,scalex=1,scaley=1,osziFlash=new Array,csvGroupCache=new Array,ursprungXoffset=.14*width,ursprungYoffset=.12*height,xDiffPerCent=.0614,yDiffPerCent=.0776,yDiffWeiteCH1=20,yDiffWeiteCH2=20,xDiffWeite=1,lineStepOnLogLine=[0,.301,.176,.125,.097,.079,.067,.058,.051,.046],firstDekadeEndeLOG=1,ursprungXoffsetLOG=.04*width,xDiffDekPerCentLOG=.3409,ursprungYoffsetLOG=.9238*height,yDiffPerCentLOG=.0859,yDiffWeiteLOG=5,platzHalterKali=[ursprungXoffset,ursprungYoffset,xDiffPerCent,yDiffPerCent,xDiffWeite,yDiffWeiteCH1,yDiffWeiteCH2],backroundKalibrierungTab=[[.1373*width,.1432*height,.0577,.1019,5,1],[.1235*width,.0917*height,.0642,.0833,20,1,1],[.1223*width,.0684*height,.0651,.0531,.1,.1,.1],[.1073*width,.1836*height,.1014,.1018,1,.1,.1],[.1351*width,.1816*height,.0657,.1021,1,.1,.1],[.3273*width,.5019*height,.0635,.1192,1,1,1],platzHalterKali,platzHalterKali,platzHalterKali,[.3262*width,.5019*height,.3156,.1192,.24,111.6,111.6],[.0714*width,.0684*height,.0361,.0532,5,1,1],[.0601*width,.0645*height,.0295,.0477,100,20,20],[ursprungXoffsetLOG,ursprungYoffsetLOG,xDiffDekPerCentLOG,yDiffPerCentLOG,xDiffWeite,5,firstDekadeEndeLOG],[ursprungXoffsetLOG,ursprungYoffsetLOG,xDiffDekPerCentLOG,yDiffPerCentLOG,xDiffWeite,10,firstDekadeEndeLOG],[ursprungXoffset,ursprungYoffset,xDiffPerCent,yDiffPerCent,xDiffWeite,yDiffWeiteCH1,yDiffWeiteCH2]],backroundKalibrierung=backroundKalibrierungTab[1];let container=document.getElementById("container");var canvas=document.createElement("canvas");canvas.width=width,canvas.height=height;var stage=new Konva.Stage({container:"container",width:width,height:height}),image=new Konva.Image({image:canvas,x:0,y:0,stroke:"red",strokeWidth:strokeWidth}),text=new Konva.Text({x:10,y:10,fontFamily:"Calibri",fontSize:24,text:"",fill:"black"}),circle=new Konva.Circle({x:stage.width()/2,y:stage.height()/2,radius:1,fill:"transparent",stroke:"red",strokeWidth:2}),context=canvas.getContext("2d");context.strokeStyle="#000000",context.lineJoin="round",context.lineWidth=1;var isPaint=!1,lastPointerPosition={x:0,y:0},mode="brush",countGerade=0,countText=0,countImage=0,shadowOffset=20,tween=null,blockSnapSize=20,layer=new Konva.Layer,backlayer=new Konva.Layer,circlelayer=new Konva.Layer,textlayer=new Konva.Layer,gridGroup=new Konva.Group;circlelayer.add(circle),layer.add(image),circlelayer.add(text),backlayer.add(gridGroup),stage.add(backlayer),stage.add(circlelayer),stage.add(layer),stage.add(textlayer);var padding=blockSnapSize;debugging&&(console.log("_______________Info Gridding_______________"),console.log("Breite: "+width),console.log("Kästchen: "+padding),console.log("Anzahl Kästchen: "+width/padding),console.log("_______________Info Kalibrierung_______________"),console.log("** Klichen Sie den Ursprung und das Offset wird Ihnen Angezeigt **"),console.log("Breite = "+width),console.log("Höhe = "+height),stage.on("click",(e=>{let t=stage.getPointerPosition(),o=t.x,s=t.y;console.log("New Click New Offset"),console.log("x-Offset = "+o/width),console.log("y-Offset = "+(height-s)/height)})));for(var i=0;i<width/padding;i++){let e=new Konva.Line({points:[Math.round(i*padding)+.5,0,Math.round(i*padding)+.5,height],stroke:"#ddd",strokeWidth:1});gridGroup.add(e)}for(var j=0;j<height/padding;j++){let e=new Konva.Line({points:[0,Math.round(j*padding),width,Math.round(j*padding)],stroke:"#ddd",strokeWidth:.5});gridGroup.add(e)}var arrowCount=0;function newArrow(e){let t="Vektor "+ ++arrowCount,o=new Konva.Group({id:t});var s=new Konva.Arrow({id:t,points:[blockSnapSize,blockSnapSize,5*blockSnapSize,blockSnapSize],draggable:!0,fill:"black",stroke:"black",strokeWidth:4,shadowOffset:{x:1,y:1},hitStrokeWidth:20,shadowOpacity:.4,pointerLength:blockSnapSize,pointerWidth:.5*blockSnapSize});let a=new Konva.Circle({x:5*blockSnapSize,y:blockSnapSize,radius:13,fill:"grey",stroke:"black",draggable:!0,opacity:.25});var i=new Konva.Label({x:170,y:75,opacity:.75,draggable:!0});i.add(new Konva.Tag({fill:"black",pointerDirection:"down",pointerWidth:10,pointerHeight:10,lineJoin:"round",shadowColor:"black",shadowBlur:10,shadowOffsetX:10,shadowOffsetY:10,shadowOpacity:.5}));let r=new Konva.Text({text:" ",fontFamily:"Calibri",fontSize:18,padding:5,fill:"white"});setVektorName(r,s,blockSnapSize),i.add(r),o.add(s),o.add(i),o.add(a),a.on("dragmove",(e=>{let t=s.getPoints(),o=s.getPosition(),i=a.getPosition();t[2]=i.x-o.x,t[3]=i.y-o.y,s.setPoints(t),setVektorName(r,s,blockSnapSize),stage.batchDraw()})),s.on("dragmove",(e=>{let t=s.getPoints(),o=s.getPosition();a.position({x:t[2]+o.x,y:t[3]+o.y}),stage.batchDraw()})),s.on("dblclick dbltap",(function(){this.getParent().destroy(),stage.draw()})),i.on("dblclick dbltap",(()=>{var e=r.getAbsolutePosition(),t=stage.container().getBoundingClientRect(),o=t.left+e.x,a=t.top+e.y,i=document.createElement("textarea");document.body.appendChild(i),i.value=s.id(),i.style.position="absolute",i.style.top=a+"px",i.style.left=o+"px",i.style.width=r.width()+"px",i.focus(),i.addEventListener("keydown",(function(e){13===e.keyCode&&(s.id(i.value),setVektorName(r,s,blockSnapSize),stage.draw(),document.body.removeChild(i))}))})),textlayer.add(o),stage.draw(),showAsGrabbable(s),showAsGrabbable(r),showAsGrabbable(a),makeItHover(a,stage),makeItHover(s,stage)}let osziControls=new Array;function newPanel(e,t,o,s,a,i,r){let n=new Array,d=[["0.01ms",1e-5],["0.02ms",2e-5],["0.05ms",5e-5],["0.1ms",1e-4],["0.2ms",2e-4],["0.5ms",5e-4],["1ms",.001]];n=s?d:[["0.01V",.01],["0.02V",.02],["0.05V",.05],["0.1V",.1],["0.2V",.2],["0.5V",.5],["1V",1],["2V",2],["5V",5]];let l=roundDown(n.length/2);function c(e,t){let o="lightgray",s="gray",a="gray",i="white";e.on("mouseover touchstart",(function(){e.setAttrs({fill:o}),t.setAttrs({fill:s})})),e.on("mouseout touchend",(function(){e.setAttrs({fill:a}),t.setAttrs({fill:i})})),e.on("mousedown",(function(){t.setAttrs({fill:"red"})})),e.on("mouseup",(function(){t.setAttrs({fill:i})})),t.on("mouseover touchstart",(function(){t.setAttrs({fill:s}),e.setAttrs({fill:o})})),t.on("mouseout touchend",(function(){t.setAttrs({fill:i}),e.setAttrs({fill:a})})),t.on("mousedown",(function(){t.setAttrs({fill:"red"})})),t.on("mouseup",(function(){t.setAttrs({fill:i})}))}s?backroundKalibrierungTab[5][4]=n[l][1]:backroundKalibrierungTab[5][5]=n[l][1];var u=new Konva.Label({id:e+l,x:i,y:r,opacity:.75,draggable:!0});u.add(new Konva.Rect({fill:"lightgray",width:120,height:80,stroke:"red",strokeWidth:1})),u.add(new Konva.Text({width:120,height:80,text:t,fontFamily:"Calibri",fontSize:22,align:"center",fontStyle:"bold",padding:5,fill:"black"}));var g=new Konva.Rect({id:"up"+e,x:5,y:28,width:20,height:20,fill:"gray",shadowBlur:3,cornerRadius:2}),m=new Konva.Rect({id:"down"+e,x:5,y:53,width:20,height:20,fill:"gray",shadowBlur:3,cornerRadius:2}),h=new Konva.Text({id:"upArrow"+e,x:28,y:28,text:"<",fontFamily:"Calibri",fontSize:25,padding:2,rotation:90,fontStyle:"bold",fill:"white"}),f=new Konva.Text({id:"downArrow"+e,x:2,y:73,text:"<",fontFamily:"Calibri",fontSize:25,padding:2,rotation:270,fontStyle:"bold",fill:"white"}),v=new Konva.Text({y:9,width:120,height:80,text:n[l][0],fontFamily:"Calibri",fontSize:20,align:"right",verticalAlign:"middle",fontStyle:"bold",padding:10,fill:"black"});return u.add(v),u.add(g),u.add(h),u.add(m),u.add(f),c(g,h),c(m,f),g.on("click touchstart",(function(){l<d.length-1&&l++,v.text(n[l][0]),s?backroundKalibrierungTab[5][4]=n[l][1]:backroundKalibrierungTab[5][4+a]=n[l][1],stage.batchDraw()})),h.on("click touchstart",(function(){l<n.length-1&&l++,v.text(n[l][0]),s?backroundKalibrierungTab[5][4]=n[l][1]:backroundKalibrierungTab[5][4+a]=n[l][1],stage.batchDraw()})),m.on("click touchstart",(function(){l>0&&l--,v.text(n[l][0]),s?backroundKalibrierungTab[5][4]=n[l][1]:backroundKalibrierungTab[5][4+a]=n[l][1],stage.batchDraw()})),f.on("click touchstart",(function(){l>0&&l--,v.text(n[l][0]),s?backroundKalibrierungTab[5][4]=n[l][1]:backroundKalibrierungTab[5][4+a]=n[l][1],stage.batchDraw()})),showAsClickable(g),showAsClickable(h),showAsClickable(m),showAsClickable(f),textlayer.add(u),u}osziControls.push(newPanel("Zeit","CH1/CH2",textlayer,!0,0,.7822*width,.27*height)),osziControls.push(newPanel("VoltCH1","CH1",textlayer,!1,1,.7282*width,.704*height)),osziControls.push(newPanel("VoltCH2","CH2",textlayer,!1,2,.7282*width+130,.704*height)),osziControls.forEach((e=>{e.hide(),textlayer.draw()}));var imageObj=new Image;function setBackground(e){document.getElementById("hintergrund").selectedIndex=e,changeToolBackground()}function changeToolBackground(){let e=document.getElementById("hintergrund").value;imageObj.src=sources[e],backroundKalibrierung=backroundKalibrierungTab[e],document.getElementById("wertetabellenInfo").innerHTML=einheitenInfo[e],debugging&&console.log("Background: "+e),5==e?osziControls.forEach((e=>{e.show(),textlayer.draw()})):osziControls.forEach((e=>{e.hide(),textlayer.draw()}))}let currentShape;imageObj.onload=function(){let e=document.getElementById("hintergrund").value;var t=new Konva.Image({draggable:!1,x:.8*strokeWidth,y:.8*strokeWidth,image:imageObj,width:width-2*strokeWidth*.8,height:height-2*strokeWidth*.8});backlayer.add(t),7==e?gridGroup.show():gridGroup.hide(),stage.draw()},imageObj.src="Data/invisible.svg",stage.draw();var menuNode=document.getElementById("menu");function writeMessage(e){text.text(e)}function updateColor(){let e=document.getElementById("BasicToolColorInput");context.strokeStyle=e.value}function preview_image(e){countImage+=1;var t=new Image(width-2*strokeWidth*.8,height-2*strokeWidth*.8),o=new FileReader;o.onload=function(){t.src=o.result};var s=document.getElementById("file-input-pic").files[0];console.log(s),o.readAsDataURL(e.target.files[0]);var a=new Konva.Image({image:t,draggable:!1,x:.8*strokeWidth,y:.8*strokeWidth});const i=new Konva.Circle({x:7+20*countImage,y:20,radius:10,fill:"red"});textlayer.add(i);const r=new Konva.Text({text:"x",x:2+20*countImage,y:10,fontSize:charpix});textlayer.add(r),i.on("touchstart click",(()=>{i.destroy(),r.destroy(),a.destroy(),stage.draw()})),r.on("touchstart click",(()=>{i.destroy(),r.destroy(),a.destroy(),stage.draw()})),i.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),this.setAttrs({fill:"#AA0000"}),textlayer.draw(),is_touch_device()&&this.setAttrs({fill:"red"})})),i.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),this.setAttrs({fill:"red"}),textlayer.draw()})),r.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),i.setAttrs({fill:"#AA0000"}),textlayer.draw(),is_touch_device()&&i.setAttrs({fill:"red"})})),r.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),i.setAttrs({fill:"red"}),textlayer.draw()})),setTimeout((function(){backlayer.add(a),backlayer.batchDraw(),stage.draw()}),100)}document.getElementById("pulse-button").addEventListener("click",(()=>{currentShape.to({scaleX:2,scaleY:2,onFinish:()=>{currentShape.to({scaleX:1,scaleY:1})}})})),document.getElementById("delete-button").addEventListener("click",(()=>{currentShape.destroy(),layer.draw()})),window.addEventListener("click",(()=>{menuNode.style.display="none"})),stage.on("contextmenu",(function(e){if(drawing=!1,e.evt.preventDefault(),e.target===textlayer||e.target===layer||e.target===image)return;currentShape=e.target,console.log(e.target),menuNode.style.display="initial";const t=stage.container().getBoundingClientRect();menuNode.style.top=`${t.top+stage.getPointerPosition().y+4}px`,menuNode.style.left=`${t.left+stage.getPointerPosition().x+4}px`})),stage.on("mousedown touchstart",(function(){layer.setZIndex(2),circlelayer.setZIndex(1),stage.draw(),isPaint=!0,lastPointerPosition=stage.getPointerPosition()})),stage.on("mouseup touchend",(function(){layer.setZIndex(1),circlelayer.setZIndex(2),stage.draw(),isPaint=!1})),stage.on("mousemove touchmove",(function(e){var t=stage.getPointerPosition(),o=t.x*(1/scalex),s=t.y*(1/scaley);circle.x(o),circle.y(s),stage.batchDraw()})),stage.on("mouseleave",(function(e){isPaint=!1})),image.on("mousemove touchmove",(function(e){var t=stage.getPointerPosition(),o=t.x,s=t.y;if(debugging&&writeMessage("x: "+o+", y: "+s),isPaint){"brush"===mode&&(context.globalCompositeOperation="source-over"),"eraser"===mode&&(context.globalCompositeOperation="destination-out"),context.beginPath(),context.moveTo(lastPointerPosition.x*(1/scalex),lastPointerPosition.y*(1/scaley));var a=stage.getPointerPosition();context.lineTo(a.x*(1/scalex),a.y*(1/scaley)),context.closePath(),context.stroke(),lastPointerPosition=a,layer.batchDraw()}}));var charpix=20;function createTextfeld(e,t,o=0,s=1,a=1,i="Doppelclick zum Editieren."){t=void 0!==t?t:{x:50+10*countText,y:80+10*countText},countText+=1;var r=new Konva.Group({name:"text-save"}),n=new Konva.Text({text:i,x:t.x,y:t.y,fontSize:charpix,draggable:!0,rotation:o,width:200,scaleX:a,scaleY:s}),d=new Konva.Transformer({node:n,enabledAnchors:["middle-right"],boundBoxFunc:function(e,t){return t.width=Math.max(30,t.width),t}});n.scaleX(a),n.scaleY(s),d.scaleX(a),d.scaleY(s);const l=new Konva.Circle({x:d.getWidth()-20,y:-15,radius:10,fill:"red"});d.add(l);const c=new Konva.Text({text:"x",x:d.getWidth()-25,y:-25,fontSize:charpix});d.add(c);const u=new Konva.Circle({x:d.getWidth()-0,y:-15,radius:10,fill:"grey"});d.add(u),d.on("transform",(()=>{drawing=!1,l.x(d.getWidth()-20),c.x(d.getWidth()-25),u.x(d.getWidth()-0)})),l.on("touchstart click",(()=>{d.destroy(),n.destroy(),textlayer.draw()})),c.on("touchstart click",(()=>{d.destroy(),n.destroy(),textlayer.draw()})),u.on("touchstart click",(()=>{d.hide(),textlayer.draw()})),n.on("transform",(function(){drawing=!1,n.setAttrs({width:n.width()*n.scaleX()})})),r.add(n),r.add(d),textlayer.add(r),textlayer.draw(),1==is_touch_device()?n.on("touchstart",(()=>{if(d.show(),textlayer.draw(),1==doubletap()){d.hide(),n.hide(),textlayer.draw();var e=n.absolutePosition(),t=stage.container().getBoundingClientRect(),o={x:t.left+e.x,y:t.top+e.y},s=document.createElement("textarea");document.body.appendChild(s),s.value=n.text(),s.style.position="absolute",s.style.top=o.y+"px",s.style.left=o.x+"px",s.style.width=n.width()-2*n.padding()+"px",s.style.height=n.height()-2*n.padding()+5+"px",s.style.fontSize=n.fontSize()+"px",s.style.border="none",s.style.padding="0px",s.style.margin="0px",s.style.overflow="hidden",s.style.background="none",s.style.outline="none",s.style.resize="none",s.style.lineHeight=n.lineHeight(),s.style.fontFamily=n.fontFamily(),s.style.transformOrigin="left top",s.style.textAlign=n.align(),s.style.color=n.fill(),rotation=n.rotation();var a="";rotation&&(a+="rotateZ("+rotation+"deg)");var i=0;function r(){s.parentNode.removeChild(s),window.removeEventListener("click",l),n.show(),d.show(),d.forceUpdate(),textlayer.draw()}function l(e){e.target!==s&&(n.text(s.value),r(),d.hide(),textlayer.draw())}navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(i+=2+Math.round(n.fontSize()/20)),a+="translateY(-"+i+"px)",s.style.transform=a,s.style.height="auto",s.style.height=s.scrollHeight+3+"px",s.focus(),s.addEventListener("keydown",(function(e){13!==e.keyCode||e.shiftKey||(n.text(s.value),r(),d.hide(),textlayer.draw()),27===e.keyCode&&r()})),s.addEventListener("keydown",(function(e){scale=n.getAbsoluteScale().x,function(e){e||(e=n.placeholder.length*n.fontSize());var t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;(t||o)&&(e=Math.ceil(e)),(document.documentMode||/Edge/.test(navigator.userAgent))&&(e+=1),s.style.width=e+"px"}(n.width()*scale),s.style.height="auto",s.style.height=s.scrollHeight+n.fontSize()+"px"})),setTimeout((()=>{window.addEventListener("tochstart",l)}))}})):(n.on("mousedown",(()=>{d.show(),textlayer.draw()})),n.on("dblclick",(()=>{d.hide(),n.hide(),textlayer.draw();var e=n.absolutePosition(),t=stage.container().getBoundingClientRect(),o=t.left+e.x,s=t.top+e.y,a=document.createElement("textarea");document.body.appendChild(a),a.value=n.text(),a.style.position="absolute",a.style.top=s+"px",a.style.left=o+"px",a.style.width=n.width()-2*n.padding()+"px",a.style.height=n.height()-2*n.padding()+5+"px",a.style.fontSize=n.fontSize()+"px",a.style.border="none",a.style.padding="0px",a.style.margin="0px",a.style.overflow="hidden",a.style.background="none",a.style.outline="none",a.style.resize="none",a.style.lineHeight=n.lineHeight(),a.style.fontFamily=n.fontFamily(),a.style.transformOrigin="left top",a.style.textAlign=n.align(),a.style.color=n.fill(),rotation=n.rotation();var i="";rotation&&(i+="rotateZ("+rotation+"deg)");var r=0;function l(){a.parentNode.removeChild(a),window.removeEventListener("click",c),n.show(),d.show(),d.forceUpdate(),textlayer.draw()}function c(e){e.target!==a&&(n.text(a.value),l(),d.hide(),textlayer.draw())}navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(r+=2+Math.round(n.fontSize()/20)),i+="translateY(-"+r+"px)",a.style.transform=i,a.style.height="auto",a.style.height=a.scrollHeight+3+"px",a.focus(),a.addEventListener("keydown",(function(e){13!==e.keyCode||e.shiftKey||(n.text(a.value),l(),d.hide(),textlayer.draw()),27===e.keyCode&&l()})),a.addEventListener("keydown",(function(e){scale=n.getAbsoluteScale().x,function(e){e||(e=n.placeholder.length*n.fontSize());var t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;(t||o)&&(e=Math.ceil(e)),(document.documentMode||/Edge/.test(navigator.userAgent))&&(e+=1),a.style.width=e+"px"}(n.width()*scale),a.style.height="auto",a.style.height=a.scrollHeight+n.fontSize()+"px"})),setTimeout((()=>{window.addEventListener("click",c)}))}))),u.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),this.setAttrs({fill:"#CCCCCC"}),textlayer.draw(),is_touch_device()&&this.setAttrs({fill:"grey"})})),u.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),this.setAttrs({fill:"grey"}),textlayer.draw()})),l.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),this.setAttrs({fill:"#AA0000"}),textlayer.draw(),is_touch_device()&&this.setAttrs({fill:"red"})})),l.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),this.setAttrs({fill:"red"}),textlayer.draw()})),c.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),l.setAttrs({fill:"#AA0000"}),textlayer.draw(),is_touch_device()&&l.setAttrs({fill:"red"})})),c.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),l.setAttrs({fill:"red"}),textlayer.draw()})),n.on("mouseover",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.add("grabbable")})),n.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser"))}))}function downloadURI(e,t){var o=document.createElement("a");o.download=t,o.href=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),delete o}function handleInputKeydown(e){13===e.which&&downloadPic()}function downloadPic(){let e=stage.toDataURL().replace("image/png","image/octet-stream"),t=document.getElementById("exportInput");""==t.value?downloadURI(e,"ZT.png"):t.value.search(".png")>-1?downloadURI(e,t.value):downloadURI(e,t.value+".png")}function readpoints(e,t){let o,s,a,i;void 0!==t?(o="dataTable"+t,s="dGraph"+t,a="showGraph"+t,i="graph-name"+t):(o="dataTable0",s="dGraph0",a="showGraph0",i="graph-name0");let r=document.getElementById("hintergrund").value,n=!1;12!=r&&13!=r||(n=!0);let d=document.getElementById(i),l=getRandomColor();var c=new Konva.Label({x:75,y:75,draggable:!0});c.add(new Konva.Tag({fill:"#bbb",stroke:l,shadowColor:"black",shadowBlur:3,shadowOffset:[10,10],shadowOpacity:.7,lineJoin:"round",pointerDirection:"right",pointerWidth:10,pointerHeight:10,cornerRadius:5})),c.add(new Konva.Text({text:d.value,fontSize:12,lineHeight:1.2,padding:2,fill:l})),showAsGrabbable(c);var u=new Konva.Group({});textlayer.add(u),u.add(c);for(var g=get(o),m=0;m<g.length;m++)if(m%2==1)g[m]=-1*(g[m]/backroundKalibrierung[5]*(backroundKalibrierung[3]*height)-height+backroundKalibrierung[1]);else if(n){let e=g[m];e*=1.001;let t=0,o=0;for(;e>1;)e/=10,t++;let s=0,a=10*e-roundDown(10*e);for(s=1;s<=10*e;s++)o+=lineStepOnLogLine[s-1];lineStepOnLogLine[0|e];g[m]=t*backroundKalibrierung[2]*width+o*backroundKalibrierung[2]*width+backroundKalibrierung[0]+a*lineStepOnLogLine[s-1]*backroundKalibrierung[2]*width,debugging&&(console.log("Rest: "+a),console.log("K: "+s),console.log("lineStepOnLogLine[k-1]: "+lineStepOnLogLine[s-1]),console.log("xxOff: "+10*-(0|e)+10*e),console.log("extraOff: "+o),console.log("Ausgabe: "+g[m]))}else g[m]=g[m]/backroundKalibrierung[4]*(backroundKalibrierung[2]*width)+backroundKalibrierung[0];for(var h=0;h<g.length;h+=2){var f=new Konva.Circle({x:g[h],y:g[h+1],radius:5,fill:l,stroke:"black",strokeWidth:4}),v=new Konva.Text({x:g[h]+5,y:g[h+1]+5,text:"P"+h/2,fontSize:20,fontFamily:"Calibri",fill:l});u.add(f),u.add(v)}debugging&&(console.log("_______________Info Gelesene Punkte_______________"),console.log(g));var b=new Konva.Line({points:g,tension:.5,strokeWidth:3,hitStrokeWidth:20,stroke:l});u.add(b),document.getElementById(s).addEventListener("click",(function(){u.destroy(),stage.draw()}),!1),document.getElementById(a).addEventListener("click",(function(){u.destroy(),stage.draw()}),!1),stage.draw()}function showcsv(e,t){let o=drawGraph(e,t);csvGroupCache[t]=o;let s=new Array,a=stage.findOne("#upZeit"),i=stage.findOne("#downZeit"),r=stage.findOne("#upArrowZeit"),n=stage.findOne("#downArrowZeit");if(1==t){let e=stage.findOne("#upVoltCH1"),t=stage.findOne("#downVoltCH1"),o=stage.findOne("#upArrowVoltCH1"),d=stage.findOne("#downArrowVoltCH1");s=[a,i,r,n,e,t,o,d]}else{let e=stage.findOne("#upVoltCH2"),t=stage.findOne("#downVoltCH2"),o=stage.findOne("#upArrowVoltCH2"),d=stage.findOne("#downArrowVoltCH2");s=[a,i,r,n,e,t,o,d]}s.forEach(((e,t)=>{e.addEventListener("click.event1",(function(){s.forEach((e=>{e.off("click.event1")})),void 0!==csvGroupCache[1]&&(csvGroupCache[1].destroy(),showcsv(osziFlash[1],1)),void 0!==csvGroupCache[2]&&(csvGroupCache[2].destroy(),showcsv(osziFlash[2],2)),stage.draw()}),!1)}))}function drawGraph(e,t){t=void 0!==t?t:1;document.getElementById("hintergrund").value;let o=document.getElementById("quali-"+t),s=(document.getElementById("f"),parseFloat(o.value)),a="CSVData "+t;e.shift();let i="#000000";void 0!==csvGroupCache[t]&&csvGroupCache[t].destroy(),i=1==t?"#0000FF":"#00FF00";var r=new Konva.Label({x:75,y:200,draggable:!0});r.add(new Konva.Tag({fill:"#bbb",stroke:i,shadowColor:"black",shadowBlur:3,shadowOffset:[10,10],shadowOpacity:.7,lineJoin:"round",pointerDirection:"right",pointerWidth:10,pointerHeight:10,cornerRadius:5})),r.add(new Konva.Text({text:a,fontSize:12,lineHeight:1.2,padding:2,fill:i})),r.on("dblclick",(function(){csvGroupCache[t].destroy()})),showAsGrabbable(r);var n=new Konva.Group({});textlayer.add(n),n.add(r);let d=new Array;for(var l=0;l<e.length;l+=s)d.push(parseFloat(e[l][0])),d.push(parseFloat(e[l][1]));for(l=0;l<d.length;l++)d[l]=l%2==1?-1*(d[l]/backroundKalibrierung[4+t]*(backroundKalibrierung[3]*height)-height+backroundKalibrierung[1]):d[l]/backroundKalibrierung[4]*(backroundKalibrierung[2]*width)+backroundKalibrierung[0];for(var c=0;c<d.length;c+=2){var u=new Konva.Circle({x:d[c],y:d[c+1],radius:5,fill:i,stroke:"black",strokeWidth:4});n.add(u)}var g=new Konva.Line({points:d,tension:.5,strokeWidth:3,hitStrokeWidth:20,stroke:i});return n.add(g),stage.draw(),n}function createLine(e,t,o){t=void 0!==t?t:{x:stage.width()/2+10*countGerade,y:stage.height()/2+10*countGerade},o=void 0!==o?o:{x:stage.width()/2+100+10*countGerade,y:stage.height()/2+10*countGerade};var s=new Konva.Group({name:"line-save"});countGerade+=1;var a=new Konva.Circle({x:t.x,y:t.y,radius:10,fill:"grey",stroke:"black",strokeWidth:1,draggable:!0}),i=a.absolutePosition(),r=new Konva.Circle({x:o.x,y:o.y,radius:10,fill:"grey",stroke:"black",strokeWidth:1,draggable:!0}),n=r.absolutePosition(),d=new Konva.Line({points:[i.x,i.y,n.x,n.y],stroke:getRandomColor(),strokeWidth:3,lineCap:"round",lineJoin:"round",tension:1,draggable:!1}),l=new Konva.Transformer({node:d,enabledAnchors:[],rotateEnabled:!1});const c=new Konva.Circle({x:l.getWidth()-20,y:-20,radius:10,fill:"red"});l.add(c);const u=new Konva.Text({text:"x",x:l.getWidth()-25,y:-30,fontSize:charpix});l.add(u);const g=new Konva.Circle({x:l.getWidth()-40,y:-20,radius:10,fillRadialGradientStartPoint:{x:0,y:0},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:0,y:0},fillRadialGradientEndRadius:8,fillRadialGradientColorStops:[0,"red",.5,"yellow",1,"blue"]});l.add(g);const m=new Konva.Circle({x:l.getWidth()-0,y:-20,radius:10,fill:"grey"});l.add(m),s.add(a,r,d,l),textlayer.add(s),d.moveToBottom(),textlayer.draw(),a.on("dragmove",(function(){l.show(),drawing=!1,i=a.getPosition(),d.setAttrs({points:[i.x,i.y,n.x,n.y]}),c.x(l.getWidth()-20),u.x(l.getWidth()-25),m.x(l.getWidth()-0),g.x(l.getWidth()-40),textlayer.batchDraw()})),r.on("dragmove",(function(){l.show(),drawing=!1,n=r.getPosition(),d.setAttrs({points:[i.x,i.y,n.x,n.y]}),c.x(l.getWidth()-20),u.x(l.getWidth()-25),m.x(l.getWidth()-0),g.x(l.getWidth()-40),textlayer.batchDraw()})),c.on("touchstart click",(()=>{l.destroy(),d.destroy(),a.destroy(),r.destroy(),stage.draw()})),u.on("touchstart click",(()=>{l.destroy(),d.destroy(),a.destroy(),r.destroy(),stage.draw()})),g.on("click touchstart",(()=>{d.setAttrs({stroke:getRandomColor()}),stage.draw()})),m.on("click touchstart",(()=>{l.hide(),stage.draw()})),r.on("mouseover",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.add("grabbable")})),a.on("mouseover",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.add("grabbable")})),r.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser"))})),a.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser"))})),g.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),this.setAttrs({fillRadialGradientStartPoint:{x:0,y:0},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:0,y:0},fillRadialGradientEndRadius:8,fillRadialGradientColorStops:[0,"blue",.5,"yellow",1,"red"]}),textlayer.draw()})),g.on("mouseout touchend",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),this.setAttrs({fillRadialGradientStartPoint:{x:0,y:0},fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:{x:0,y:0},fillRadialGradientEndRadius:8,fillRadialGradientColorStops:[0,"red",.5,"yellow",1,"blue"]}),textlayer.draw()})),m.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),this.setAttrs({fill:"#CCCCCC"}),textlayer.draw(),is_touch_device()&&this.setAttrs({fill:"grey"})})),m.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),this.setAttrs({fill:"grey"}),textlayer.draw()})),c.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),this.setAttrs({fill:"#AA0000"}),textlayer.draw(),is_touch_device()&&this.setAttrs({fill:"red"})})),c.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),this.setAttrs({fill:"red"}),textlayer.draw()})),u.on("mouseover touchstart",(function(){Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pointer"),c.setAttrs({fill:"#AA0000"}),textlayer.draw(),is_touch_device()&&c.setAttrs({fill:"red"})})),u.on("mouseout",(function(){"brush"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("pencil")),"eraser"===mode&&(Mousemode.classList.remove("pencil"),Mousemode.classList.remove("pointer"),Mousemode.classList.remove("eraser"),Mousemode.classList.remove("grabbable"),Mousemode.classList.add("eraser")),c.setAttrs({fill:"red"}),textlayer.draw()}))}function fitStageIntoParentContainer(){isPaint=!1;var e=document.querySelector("#stage-parent"),t=e.offsetWidth,o=e.offsetHeight;scalex=t/width,scaley=o/height,stage.width(width*scalex),stage.height(height*scaley),stage.scale({x:scalex,y:scaley}),stage.batchDraw()}function clearContext(){context.clearRect(0,0,canvas.width,canvas.height),stage.draw()}window.addEventListener("resize",fitStageIntoParentContainer);